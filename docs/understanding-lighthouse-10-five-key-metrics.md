# 深入 Lighthouse 10 的五大性能指标

[Lighthouse](https://github.com/GoogleChrome/lighthouse) 是谷歌开源的自动化工具，它可以对网页进行全面的审查，并提供关于性能、无障碍功能、最佳做法和 SEO 的评分和建议。

下图是在 Chrome DevTools 中使用 Lighthouse 分析 Google 首页生成的报告。

> Lighthouse 不仅可以在 Chrome DevTools 中使用，还支持命令行工具或集成到 CI/CD 中。

::: details 点击查看 Google 首页的 Lighthouse 报告
<img src='./assets/lighthouse.png' width='420px' />

:::

根据 Lighthouse 报告可以直观的看出，Google 首页的性能指标完美，最佳做法和 SEO 良好，而无障碍方面需要改进。

指标分数对应的颜色与评价：

| 颜色 | 指标（分数） |     评价 |
| :--: | ------------ | -------: |
| 红色 | [0, 49)      |       差 |
| 橙色 | [50, 89)     | 需要改进 |
| 绿色 | [90, 100)    |     良好 |
| 绿色 | 100          |     完美 |

由于当前我们的关注重点是网站性能，因此其余三项指标我们不继续深入。

继续观察分析报告里面性能部分，可以看到有五个指标，它们才是重点。

### ⓵ FCP 首次内容绘制 [First Contentful Paint](https://web.dev/articles/fcp?hl=zh-cn)

FCP 衡量从用户首次导航到网页到网页任何内容在屏幕上呈现的时间。

通俗说就是从刚进页面开始，到页面有任何内容渲染出来，一共用了多长时间。

> 任何内容指的是文本、图片（包括背景图）、svg 或非白色 canvas 元素。

需要注意的是这个时间包括上一个页面的卸载时间（如果是页面间跳转的话）和页面网络请求时间，也就是说从浏览器地址栏点回车的那一刻或者在页面里面点路由跳转的那一刻就已经开始算 FCP 了。

指标评价：

| 评价     |   指标（秒）   |
| -------- | :------------: |
| 好       |     ≤ 1.8      |
| 需要改进 | 1.8 < 用时 ≤ 3 |
| 差       |      > 3       |

### ⓶ LCP 最大内容绘制 [Largest Contentful Paint](https://web.dev/articles/lcp?hl=zh-cn)

LCP 衡量从用户首次导航到网页到网页最大内容在屏幕上呈现的时间。LCP 同样需要考虑上一个页面的卸载时间和页面网络请求时间。

最大内容包括可见的最大图片、文本块或视频(封面或第一帧)。

LCP 是核心页面性能指标，因为它代表用户能看到页面最有价值的内容需要等待多长时间。

首屏加载速度就是用 LCP 指标衡量的。

指标评价：

| 评价     |   指标（秒）   |
| -------- | :------------: |
| 好       |     ≤ 2.5      |
| 需要改进 | 2.5 < 用时 ≤ 4 |
| 差       |      > 4       |

### ⓷ 总阻塞时间 Total Blocking Time

TBT 衡量的是网页的可交互性。

在 Lighthouse 10 之前，衡量这一指标用的是**可交互时间** TTI (Time to Interactive) ，它代表网页满足可靠可交互所需的时间。
可靠可交互网页需满足条件：

- 网页显示有效内容，即已完成 FCP 首次内容绘制。
- 大多数可见页面元素已注册事件处理脚本。
- 没有长任务阻塞用户交互响应。

> 执行时间超过 50ms 的任务就是长任务。

TTI 越短，代表用户能越早与页面进行交互。但是 TTI 有个很严重的问题，就是对长任务非常敏感，举个例子：

网页 A 在 10s 内有三个执行 51ms 的长任务。
网页 B 在 10s 内有一个执行 9.8s 的长任务。

网页 A 和 B 都受长任务影响，达到可靠可交互的时间大致相同，差不多都是 10s 左右，但是网页 B 的实际体验比 A 要差的多，因为 B 有一个超长任务阻塞，而 A 的长任务相比 B 时间短很多，在此期间 A 可以响应交互，B 则不可交互，这一点 TTI 无法体现。

因此在 Lighthouse 10 TTI 作为指标已被移除了。

### ⓸ 累计布局偏移 Cumulative Layout Shift

### ⓹ 速度指数 Speed Index
